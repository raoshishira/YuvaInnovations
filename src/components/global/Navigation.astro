---
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";
import { getLangFromUrl, getUrlWithoutLang, useTranslations, useTranslatedPath } from "@i18n/utils";

const lang = getLangFromUrl(Astro.url);
const path = getUrlWithoutLang(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

let pages = [
  { title: "Home", url: "/" },
  { title: "About Us", url: "/about/" },
  { title: "Blog", url: "/blog/" },
  { title: t("Contact"), url: "/contact/" },
];

const { pathname } = Astro.url;
---

<header class="z-50 w-full">
  <div class="navigation fixed top-10 right-0 z-50 w-full">
    <div class="mx-auto w-full md:max-w-fit">
      <div
        class="shadow-thick resizable nav-container squircle relative mx-auto flex w-full flex-col justify-center items-center overflow-x-hidden bg-zinc-900 backdrop-blur-xl backdrop-filter md:flex-row md:items-center md:justify-between md:py-0"
      >
        <!-- Logo -->
        <div class="logo-container flex items-center justify-center px-4 md:px-6" style="height: 100%;">
          <a href="/" class="block h-full max-h-full">
            <Image
              src="/logo.svg"
              alt="Logo"
              width={50}
              height={40}
              class="max-h-[3rem] w-auto object-contain"
            />
          </a>
        </div>

        <!-- Mobile Menu Toggle -->
        <div class="flex flex-row items-center justify-end md:hidden">
          <a class="px-3 py-[0.4rem] pl-4" href={translatePath("/contact/")} aria-label="Contact Page">
            <Icon class="text-white" name="octicon:mail-16" width="20" />
          </a>
          <button
            id="menu-toggle"
            aria-label="Toggle navbar"
            class="inline-flex items-center justify-center px-3 py-[0.4rem] pr-4 text-white hover:text-blue-300"
          >
            <!-- Hamburger -->
            <svg id="icon-hamburger" class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              />
            </svg>
            <!-- Close -->
            <svg id="icon-close" class="h-6 w-6 hidden" stroke="currentColor" fill="none" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>

        <!-- Navigation -->
        <nav id="mobile-menu" class="hidden flex-grow flex-col justify-center py-12 md:flex md:py-0">
          <ul class="flex list-none flex-col items-end justify-center gap-2 px-2 text-center text-3xl md:flex-row md:items-center md:text-base">
            {
              pages.map((page) => (
                <li data-cursor-hover>
                  <a
                    href={translatePath(page.url)}
                    class={`inline-block cursor-pointer px-1 py-[0.33rem] ${
                      page.url === pathname ||
                      page.url === pathname.replace(/^\/it|\/$/, "") ||
                      (page.url === "/blog" && (pathname.startsWith("/blog") || pathname.startsWith("/it/blog")))
                        ? "active"
                        : ""
                    }`}
                  >
                    <span class="menu-item-container inline-block">
                      <span class="menu-item px-4 py-1 font-semibold uppercase tracking-wide text-zinc-400 hover:text-white">
                        {page.title}
                      </span>
                    </span>
                  </a>
                </li>
              ))
            }
            <li>
              <a href={translatePath(path, `${lang === "it" ? "en" : "it"}`)} class="inline-block cursor-pointer px-1 py-[0.33rem]">
                <span class="menu-item-container inline-block">
                  <span class="menu-item px-4 py-1 font-semibold uppercase tracking-wide text-zinc-400 hover:text-white">
                    {lang === "it" ? "en" : "it"}
                  </span>
                </span>
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

<style>
  .navigation {
    mix-blend-mode: difference;
  }
  nav a .menu-item-container {
    border-radius: 0.45rem;
  }
  nav a.active .menu-item-container,
  nav a:hover .menu-item-container {
    transition: background-color 0.3s ease;
  }
  nav a.active .menu-item-container {
    background: #aaa;
  }
  nav a:hover .menu-item-container {
    background: #fff;
  }
  nav a.active .menu-item,
  nav a:hover .menu-item {
    color: #000;
  }

  /* Force menu visible on md and up even if hidden */
  @media (min-width: 768px) {
    #mobile-menu {
      display: flex !important;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const toggleBtn = document.getElementById("menu-toggle");
    const menu = document.getElementById("mobile-menu");
    const iconHamburger = document.getElementById("icon-hamburger");
    const iconClose = document.getElementById("icon-close");

    toggleBtn.addEventListener("click", () => {
      menu.classList.toggle("show");   // toggle hidden on mobile menu
      iconHamburger.classList.toggle("hidden");
      iconClose.classList.toggle("hidden");
    });
  });
</script>
